<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>api/meeting.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-DateTime.html">DateTime</a><ul class='methods'><li data-type='method'><a href="module-DateTime.html#~ceilScaleTs">ceilScaleTs</a></li><li data-type='method'><a href="module-DateTime.html#~dayText">dayText</a></li><li data-type='method'><a href="module-DateTime.html#~dayTextTs">dayTextTs</a></li><li data-type='method'><a href="module-DateTime.html#~fl2ts">fl2ts</a></li><li data-type='method'><a href="module-DateTime.html#~generateTsSequence">generateTsSequence</a></li><li data-type='method'><a href="module-DateTime.html#~getDateListOfNLength">getDateListOfNLength</a></li><li data-type='method'><a href="module-DateTime.html#~hhmm2fl">hhmm2fl</a></li><li data-type='method'><a href="module-DateTime.html#~nearestScaleTs">nearestScaleTs</a></li><li data-type='method'><a href="module-DateTime.html#~ts2hhmm">ts2hhmm</a></li><li data-type='method'><a href="module-DateTime.html#~tsDiff2hms">tsDiff2hms</a></li><li data-type='method'><a href="module-DateTime.html#~ymdFormat">ymdFormat</a></li><li data-type='method'><a href="module-DateTime.html#~ymdFormatTs">ymdFormatTs</a></li></ul></li><li></li><li></li><li><a href="module-LoginApi.html">LoginApi</a><ul class='methods'><li data-type='method'><a href="module-LoginApi.html#.wxLoginApi">wxLoginApi</a></li><li data-type='method'><a href="module-LoginApi.html#.wxOauth2Url">wxOauth2Url</a></li></ul></li><li><a href="module-MeetingFormat.html">MeetingFormat</a><ul class='methods'><li data-type='method'><a href="module-MeetingFormat.html#~formatMeetings">formatMeetings</a></li></ul></li><li><a href="module-MeetingOperApi.html">MeetingOperApi</a><ul class='methods'><li data-type='method'><a href="module-MeetingOperApi.html#~wrappedCancelMeetingById">wrappedCancelMeetingById</a></li><li data-type='method'><a href="module-MeetingOperApi.html#~wrappedEditRepeatedMeeting">wrappedEditRepeatedMeeting</a></li><li data-type='method'><a href="module-MeetingOperApi.html#~wrappedEditSingleMeeting">wrappedEditSingleMeeting</a></li><li data-type='method'><a href="module-MeetingOperApi.html#~wrappedForceEndMeetingById">wrappedForceEndMeetingById</a></li><li data-type='method'><a href="module-MeetingOperApi.html#~wrappedGetMeetingById">wrappedGetMeetingById</a></li><li data-type='method'><a href="module-MeetingOperApi.html#~wrappedReserveRepeatedMeeting">wrappedReserveRepeatedMeeting</a></li><li data-type='method'><a href="module-MeetingOperApi.html#~wrappedReserveSingleMeeting">wrappedReserveSingleMeeting</a></li></ul></li><li><a href="module-MeetingQueryApi.html">MeetingQueryApi</a><ul class='methods'><li data-type='method'><a href="module-MeetingQueryApi.html#~wrappedGetMeetings">wrappedGetMeetings</a></li><li data-type='method'><a href="module-MeetingQueryApi.html#~wrappedGetMeetingsByCreator">wrappedGetMeetingsByCreator</a></li><li data-type='method'><a href="module-MeetingQueryApi.html#~wrappedGetMeetingsByRoomId">wrappedGetMeetingsByRoomId</a></li></ul></li><li></li><li><a href="module-Timeline.html">Timeline</a><ul class='methods'><li data-type='method'><a href="module-Timeline.html#.findNextLargerTime">findNextLargerTime</a></li><li data-type='method'><a href="module-Timeline.html#.findPreviousSmallerTime">findPreviousSmallerTime</a></li><li data-type='method'><a href="module-Timeline.html#~fullCheck">fullCheck</a></li><li data-type='method'><a href="module-Timeline.html#~isBothValid">isBothValid</a></li><li data-type='method'><a href="module-Timeline.html#~isCorrectOrder">isCorrectOrder</a></li><li data-type='method'><a href="module-Timeline.html#~isLeftHandleValid">isLeftHandleValid</a></li><li data-type='method'><a href="module-Timeline.html#~isRightHandleValid">isRightHandleValid</a></li></ul></li><li></li><li><a href="module-UI.html">UI</a><ul class='methods'><li data-type='method'><a href="module-UI.html#.showModal">showModal</a></li><li data-type='method'><a href="module-UI.html#.showToast">showToast</a></li><li data-type='method'><a href="module-UI.html#~gotoPage">gotoPage</a></li><li data-type='method'><a href="module-UI.html#~navigateBack">navigateBack</a></li><li data-type='method'><a href="module-UI.html#~returnToIndex">returnToIndex</a></li></ul></li><li></li></ul><h3>Global</h3><ul><li><a href="global.html#MEETING_EXPIRED">MEETING_EXPIRED</a></li><li><a href="global.html#MEETING_FINISHED">MEETING_FINISHED</a></li><li><a href="global.html#MEETING_IN_PROGRESS">MEETING_IN_PROGRESS</a></li><li><a href="global.html#MEETING_TO_START">MEETING_TO_START</a></li><li><a href="global.html#SEC_PER_HOUR">SEC_PER_HOUR</a></li><li><a href="global.html#SEC_PER_MINUTE">SEC_PER_MINUTE</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">api/meeting.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module MeetingOperApi */

import request from '@/utils/request';
import dayjs from "dayjs";
import _ from 'lodash'

/**
 * @private
 * @function
 * @author Octene
 * @description 编辑/新增单次/循环会议
 * @param {Object} query
 * */
export function editMeetingByIdApi(query) {
    return request({
        url: '/call.php?act=entry%2Fedit_entry_handler',
        method: 'post',
        data:
        {
        "area_id": 20,
        "area_name": "shanghai",
        "room_id": 18,
        "room_name": "TestA",
        "rooms": [
            18
        ],
        "name": "小小王的会",
        "start_date": "2024-11-13",
        "start_hour": "19:30",
        "start_seconds": 1731497400,
        "end_date": "2024-11-13",
        "end_hour": "19:45",
        "end_seconds": 1731498300,
        "description": "",
        "repeat_week": "1",
        "check_list": [],
        "rep_end_date": "",
        "all_day": "",
        "type": "E",
        "original_room_id": 18,
        "ical_uid": "1123123",
        "ical_sequence": 1,
        "ical_recur_id": "asdfa",
        "allow_registration": "",
        "registrant_limit": 10,
        "registrant_limit_enabled": "1",
        "registration_opens_value": 1,
        "registration_open_units": "w",
        "registration_open_enabled": "",
        "registration_closes_value": 1,
        "registration_closes_units": "w",
        "registration_closes_enabled": "",
        "rep_id": null,
        "edit_series": 0,
        "rep_type": 0,
        "rep_day": [],
        "rep_interval": 1,
        "month_type": 0,
        "month_absolute": 2,
        "month_relative_ord": "",
        "month_relative_day": "",
        "skip": 0,
        "no_mail": 1,
        "private": "",
        ...query
        },
    })
}


/**
 * @private
 * @function
 * @author Octene
 * @description 取消会议
 * @param {Object} query
 * */
export function cancelMeetingByIdApi(query) {
    return request({
        url: '/call.php?act=entry%2Fdel_entry',
        method: 'post',
        data: query,
    })
}

/**
 * @private
 * @function
 * @author Octene
 * @description 提前结束会议
 * @param {Object} query
 * */
export function forceEndMeetingByIdApi(query) {
    return request({
        url: '/call.php?act=entry%2Fforce_end_entry',
        method: 'post',
        data: query,
    })
}

/**
 * @private
 * @function
 * @author Octene
 * @description 查询特定id的会议
 * @param {Object} query
 * */
export function getMeetingByIdApi(query) {
    return request({
        url: '/call.php?act=get_info%2Fget_entry_by_id',
        method: 'post',
        data: {is_series: 0,...query},
    })
}

//================工具函数================

function testNumber(val){ // 判断是否为纯数字
	const str = /^[0-9]+$/
	const reg = new RegExp(str)
	return reg.test(val)
}

function convertToBinaryWithSundayLeft(rep_day){
	let binaryArray = new Array(7).fill('0');

	rep_day.forEach(value => {
		binaryArray[parseInt(value)] = 1;
	});
	return binaryArray.join('');
}


//================包装函数================

/**
 * @function
 * @author Octene
 * @description 查询特定id的会议
 * @param {Number} id 会议id，如果是循环会议则是repeat_id
 * @param {Boolean} isSeries 查询的是否为循环会议
*/
const wrappedGetMeetingById = (entryId,isSeries)=>{
	const temp = {
	  is_series: isSeries?1:0,
	  id: entryId,
	}
	
	return new Promise((resolve, reject)=>{
	  getMeetingByIdApi(temp)
	    .then(({code,msg,data}) => {
			
		  if(code!=0) throw new Error(msg)
			
	      resolve(data)
	    })
	    .catch(err => {
	      reject(err.message)
	    })
	})
}

/**
 * @function
 * @author Octene
 * @description 取消会议
 * @param {Number} id 会议id（不是repeat_id）
 * @param {Boolean} isSeries 取消的是否为循环会议
*/
const wrappedCancelMeetingById = (entryId,isSeries)=>{
	const temp = {
	  entry_series: isSeries?1:0,
	  entry_id: entryId
	}
	
	return new Promise((resolve, reject)=>{
	  cancelMeetingByIdApi(temp)
	    .then(({code,msg,data}) => {
			
		  if(code!=0) throw new Error(msg)
			
	      resolve(data)
	    })
	    .catch(err => {
	      reject(err.message)
	    })
	})
}


/**
 * @function
 * @author Octene
 * @description 预定单次会议
 * @param {Number} area_id 区域id
 * @param {String} area_name 区域名称
 * @param {Number} room_id 房间id
 * @param {String} room_name 房间名称
 * @param {Number} capacity 房间容量（非负）
 * @param {String} topic 会议主题
 * @param {Number} start_ts 起始时间戳（s）
 * @param {Number} end_ts 结束时间戳（s）
*/
const wrappedReserveSingleMeeting = (area_id,area_name,room_id,room_name,capacity,topic,start_ts,end_ts)=>{
	
	const startObj = dayjs.unix(start_ts)
	const endObj = dayjs.unix(end_ts)
	
	const temp = {
		"area_id": area_id,
		"area_name": area_name,
		"room_id": room_id,
		"room_name": room_name,
		"rooms": [
			room_id
		],
		"name": testNumber(topic) ? ('"' + topic + '"') : topic,
		"start_date": startObj.format("YYYY-MM-DD"),
		"start_hour": startObj.format("HH:mm"),
		"start_seconds": start_ts,
		"end_date": endObj.format("YYYY-MM-DD"),
		"end_hour": endObj.format("HH:mm"),
		"end_seconds": end_ts,
		"original_room_id": room_id,
		"registrant_limit": capacity
	}
	
	return new Promise((resolve, reject)=>{
	  editMeetingByIdApi(temp)
	    .then(({code,msg,data}) => {
			
		  if(code!=0) throw new Error(msg)
			
	      resolve(data)
	    })
	    .catch(err => {
	      reject(err.message)
	    })
	})
}

/**
 * @function
 * @author Octene
 * @description 预定循环会议
 * @param {Number} area_id 区域id
 * @param {String} area_name 区域名称
 * @param {Number} room_id 房间id
 * @param {String} room_name 房间名称
 * @param {Number} capacity 房间容量（非负）
 * @param {String} topic 会议主题
 * @param {Number} start_ts 起始时间戳（s）
 * @param {Number} end_ts 结束时间戳（s）
 * @param {String} rep_end_date 循环结束日期（YYYY-MM-DD）
 * @param {String[]} rep_day 循环模式，每项在0~6之间（["4","0","1"]）
 * @param {Number} rep_interval 间隔天数（1~4）
*/
const wrappedReserveRepeatedMeeting = (area_id,area_name,room_id,room_name,capacity,topic,start_ts,end_ts,rep_end_date,rep_day,rep_interval)=>{
	
	const startObj = dayjs.unix(start_ts)
	const endObj = dayjs.unix(end_ts)
	
	
	const temp = {
		"area_id": area_id,
		"area_name": area_name,
		"room_id": room_id,
		"room_name": room_name,
		"rooms": [
			room_id
		],
		"name": testNumber(topic) ? ('"' + topic + '"') : topic,
		"start_date": startObj.format("YYYY-MM-DD"),
		"start_hour": startObj.format("HH:mm"),
		"start_seconds": start_ts,
		"end_date": endObj.format("YYYY-MM-DD"),
		"end_hour": endObj.format("HH:mm"),
		"end_seconds": end_ts,
		"rep_end_date": rep_end_date,
		"original_room_id": room_id,
		"registrant_limit": capacity,
		"edit_series": 1, // 决定循环会议
		"rep_day": rep_day,
		"rep_interval": rep_interval,
		"rep_opt": convertToBinaryWithSundayLeft(rep_day),
		"rep_type": 2,
	}
	
	return new Promise((resolve, reject)=>{
	  editMeetingByIdApi(temp)
	    .then(({code,msg,data}) => {
			
		  if(code!=0) throw new Error(msg)
			
	      resolve(data)
	    })
	    .catch(err => {
	      reject(err.message)
	    })
	})
}

/**
 * @function
 * @author Octene
 * @description 编辑单次会议
 * @param {Number} entry_id 会议id
 * @param {Number} area_id 区域id
 * @param {String} area_name 区域名称
 * @param {Number} room_id 房间id
 * @param {String} room_name 房间名称
 * @param {Number} capacity 房间容量（非负）
 * @param {String} topic 会议主题
 * @param {Number} start_ts 起始时间戳（s）
 * @param {Number} end_ts 结束时间戳（s）
*/
const wrappedEditSingleMeeting = (entry_id,area_id,area_name,room_id,room_name,capacity,topic,start_ts,end_ts)=>{

	const startObj = dayjs.unix(start_ts)
	const endObj = dayjs.unix(end_ts)

	const temp = {
		"id": entry_id,
		"area_id": area_id,
		"area_name": area_name,
		"room_id": room_id,
		"room_name": room_name,
		"rooms": [
			room_id
		],
		"name": testNumber(topic) ? ('"' + topic + '"') : topic,
		"start_date": startObj.format("YYYY-MM-DD"),
		"start_hour": startObj.format("HH:mm"),
		"start_seconds": start_ts,
		"end_date": endObj.format("YYYY-MM-DD"),
		"end_hour": endObj.format("HH:mm"),
		"end_seconds": end_ts,
		"original_room_id": room_id,
		"registrant_limit": capacity
	}
	
	
	return new Promise((resolve, reject)=>{
	  editMeetingByIdApi(temp)
	    .then(({code,msg,data}) => {
			
		  if(code!=0) throw new Error(msg)
			
	      resolve(data)
	    })
	    .catch(err => {
	      reject(err.message)
	    })
	})
}


/**
 * @function
 * @author Octene
 * @description 编辑循环会议
 * @param {Number} entry_id 会议id
 * @param {Number} repeat_id 循环会议repeat_id
 * @param {Number} area_id 区域id
 * @param {String} area_name 区域名称
 * @param {Number} room_id 房间id
 * @param {String} room_name 房间名称
 * @param {Number} capacity 房间容量（非负）
 * @param {String} topic 会议主题
 * @param {String} start_date 起始日期（YYYY-MM-DD）
 * @param {String} time1 会议开始时间（HH:mm）
 * @param {String} time2 会议结束时间（HH:mm）
 * @param {String} end_date 结束日期（YYYY-MM-DD）
 * @param {String[]} rep_day 循环模式，每项在0~6之间（["4","0","1"]）
 * @param {Number} rep_interval 间隔天数（1~4）
*/
const wrappedEditRepeatedMeeting = (entry_id,repeat_id,area_id,area_name,room_id,room_name,capacity,topic,start_date,time1,time2,end_date,rep_day,rep_interval)=>{

	const temp = {
		"area_id": area_id,
		"area_name": area_name,
		"room_id": room_id,
		"room_name": room_name,
		"rooms": [
			room_id
		],
		"name": testNumber(topic) ? ('"' + topic + '"') : topic,
		"start_date": start_date,
		"start_hour": time1,
		"start_seconds": dayjs(start_date + ' ' + time1, 'YYYY-MM-DD HH:mm').unix(),
		"end_date": start_date,
		"end_hour": time2,
		"end_seconds": dayjs(start_date + ' ' + time2,'YYYY-MM-DD HH:mm').unix(),
		"rep_end_date": end_date,
		"original_room_id": room_id,
		"tmp_repeat_id": repeat_id,
		"id": entry_id,
		"registrant_limit": capacity,
		"edit_series": 1, // 决定循环会议
		"rep_day": rep_day,
		"rep_interval": rep_interval,
		"rep_opt": convertToBinaryWithSundayLeft(rep_day),
		"rep_type": 2,
		"skip": 1 // 忽略冲突
	}
	
	return new Promise((resolve, reject)=>{
	  editMeetingByIdApi(temp)
	    .then(({code,msg,data}) => {
			
		  if(code!=0) throw new Error(msg)
			
	      resolve(data)
	    })
	    .catch(err => {
	      reject(err.message)
	    })
	})
}

/**
 * @function
 * @author Octene
 * @description 提前结束会议
 * @param {Number} entry_id 会议id
*/
const wrappedForceEndMeetingById = (entry_id)=>{
	
	const temp = {
		"id": entry_id
	}
	
	return new Promise((resolve, reject)=>{
	  forceEndMeetingByIdApi(temp)
	    .then(({code,msg,data}) => {
			
		  if(code!=0) throw new Error(msg)
			
	      resolve(data)
	    })
	    .catch(err => {
	      reject(err.message)
	    })
	})
	
}

export {
	wrappedGetMeetingById,
	wrappedCancelMeetingById,
	wrappedReserveSingleMeeting,
	wrappedReserveRepeatedMeeting,
	wrappedEditSingleMeeting,
	wrappedEditRepeatedMeeting,
	wrappedForceEndMeetingById
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Mon Dec 02 2024 16:00:21 GMT+0800 (中国标准时间) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
